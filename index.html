<!DOCTYPE html>
<html
  lang="th"
  x-data="mediaPlayer()"
  x-init="initFromURL()"
  class="bg-black text-white"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Media Fullscreen Player</title>
    <script
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
      defer
    ></script>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="overflow-hidden h-screen w-screen">
    <!-- Input Box -->
    <form
      x-show="!mediaSrc"
      @submit.prevent="playMedia"
      class="absolute z-10 top-4 left-1/2 transform -translate-x-1/2 bg-black/70 backdrop-blur px-4 py-3 rounded-lg flex items-center gap-2"
    >
      <input
        type="text"
        x-model="input"
        placeholder="YouTube ID หรือ URL ของภาพ/วิดีโอ"
        class="px-3 py-2 rounded bg-white text-black w-96"
        required
      />
      <button
        type="submit"
        class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded text-white"
      >
        แสดงสื่อ
      </button>
    </form>

    <!-- Media Display -->
    <div
      class="fixed inset-0 bg-black overflow-hidden flex items-center justify-center"
    >
      <!-- YouTube -->
      <template x-if="mediaType === 'youtube'">
        <iframe
          :src="mediaSrc"
          allow="autoplay; fullscreen; encrypted-media"
          allowfullscreen
          class="absolute top-0 left-0 w-screen h-screen border-none"
        ></iframe>
      </template>

      <!-- Image -->
      <template x-if="mediaType === 'image'">
        <img
          :src="mediaSrc"
          class="object-contain w-screen h-screen"
          alt="media"
        />
      </template>

      <!-- Video -->
      <template x-if="mediaType === 'video'">
        <video
          :src="mediaSrc"
          autoplay
          muted
          loop
          playsinline
          class="absolute top-0 left-0 w-screen h-screen object-cover"
        ></video>
      </template>
    </div>

    <script>
      function mediaPlayer() {
        return {
          input: "",
          mediaSrc: "",
          mediaType: "",

          playMedia() {
            this.detectMediaType(this.input);
          },

          detectMediaType(value) {
            const trimmed = value.trim();
            const isImage = /\.(jpg|jpeg|png|gif|webp)$/i.test(trimmed);
            const isVideo = /\.(mp4|webm|ogg)$/i.test(trimmed);
            const youTubeIdRegex = /^[\w-]{11}$/;
            const youTubeUrlRegex =
              /(?:youtube\.com\/watch\?v=|youtu\.be\/)([\w-]{11})/;

            if (isImage) {
              this.mediaType = "image";
              this.mediaSrc = trimmed;
            } else if (isVideo) {
              this.mediaType = "video";
              this.mediaSrc = trimmed;
            } else if (youTubeIdRegex.test(trimmed)) {
              // กรณีเป็น ID ตรงๆ
              this.mediaType = "youtube";
              this.mediaSrc = this.buildYouTubeEmbed(trimmed);
            } else if (youTubeUrlRegex.test(trimmed)) {
              // แยก ID จากลิงก์ YouTube
              const match = trimmed.match(youTubeUrlRegex);
              const videoId = match[1];
              this.mediaType = "youtube";
              this.mediaSrc = this.buildYouTubeEmbed(videoId);
            } else {
              alert(
                "กรุณาใส่ลิงก์ .jpg, .png, .gif, .mp4 หรือ YouTube ID/URL เท่านั้น"
              );
            }
          },

          buildYouTubeEmbed(id) {
            return `https://www.youtube.com/embed/${id}?autoplay=1&mute=1&rel=0&controls=0&showinfo=0&modestbranding=1&playsinline=1`;
          },

          initFromURL() {
            const params = new URLSearchParams(window.location.search);
            const mediaParam = params.get("media");
            if (mediaParam) {
              this.input = mediaParam;
              this.playMedia();
            }
          },
        };
      }
    </script>
  </body>
</html>
